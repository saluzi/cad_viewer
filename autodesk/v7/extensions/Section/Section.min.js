/*!
 * LMV v7.1.0
 * 
 * Copyright 2019 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Section=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=375)}({1:function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o=function(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}(i),r=i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"});return[n].concat(r).concat([o]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},2:function(t,e,n){var i={},o=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),r=function(t){var e={};return function(t,n){if("function"==typeof t)return t();if(void 0===e[t]){var i=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}}(),a=null,s=0,c=[],l=n(3);function h(t,e){for(var n=0;n<t.length;n++){var o=t[n],r=i[o.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](o.parts[a]);for(;a<o.parts.length;a++)r.parts.push(f(o.parts[a],e))}else{var s=[];for(a=0;a<o.parts.length;a++)s.push(f(o.parts[a],e));i[o.id]={id:o.id,refs:1,parts:s}}}}function u(t,e){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=e.base?r[0]+e.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function E(t,e){var n=r(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=c[c.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),c.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=r(t.insertAt.before,n);n.insertBefore(e,o)}}function p(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function d(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var i=function(){0;return n.nc}();i&&(t.attrs.nonce=i)}return m(e,t.attrs),E(t,e),e}function m(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function f(t,e){var n,i,o,r;if(e.transform&&t.css){if(!(r=e.transform(t.css)))return function(){};t.css=r}if(e.singleton){var c=s++;n=a||(a=d(e)),i=T.bind(null,n,c,!1),o=T.bind(null,n,c,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),E(t,e),e}(e),i=function(t,e,n){var i=n.css,o=n.sourceMap,r=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||r)&&(i=l(i));o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,n,e),o=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=d(e),i=function(t,e){var n=e.css,i=e.media;i&&t.setAttribute("media",i);if(t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}.bind(null,n),o=function(){p(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=u(t,e);return h(n,e),function(t){for(var o=[],r=0;r<n.length;r++){var a=n[r];(s=i[a.id]).refs--,o.push(s)}t&&h(u(t,e),e);for(r=0;r<o.length;r++){var s;if(0===(s=o[r]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete i[s.id]}}}};var v=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}();function T(t,e,n,i){var o=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=v(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}},260:function(t,e,n){var i=n(261);"string"==typeof i&&(i=[[t.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(2)(i,o);i.locals&&(t.exports=i.locals)},261:function(t,e,n){(t.exports=n(1)(!1)).push([t.i,"/**\n * Section CSS\n **/\n.sectionPanel {\n    line-height: 14px;\n    text-align: left;\n    z-index: 10;\n}\n\n.section-horizontal-divider\n{\n    height: 1px;\n    border-top: 1px solid rgba(200,200,200,0.8);\n}\n\n.section-submenu-select\n{\n    display: block;\n    position: relative;\n    width: calc(100% - 40px);\n    padding: 10px 20px 0px 20px;\n    opacity: 0.3;\n}\n\n.section-panel:hover .section-submenu-select {\n   opacity: 0.8;\n}\n\n.section-submenu-selectlabel\n{\n    position: relative;\n    display:  inline-block;\n    padding-right:  20px;\n    padding-bottom:  4px;\n}\n\n.section-restart {\n    margin: 10px 20px 15px 20px;\n    padding: 6px 10px 6px 10px;\n    width: calc(100% - 55px);\n    cursor: pointer;\n}\n\n.docking-panel:hover .section-restart {\n    background-color: rgba(255,255,255, .12);\n}\n\n.docking-panel .section-restart:hover {\n    background-color: rgba(166,194,255, 0.7);\n    -webkit-transition: all 0.2s ease;\n    -moz-transition: all 0.2s ease;\n    -ms-transition: all 0.2s ease;\n    -o-transition: all 0.2s ease;\n    transition: all 0.2s ease;\n}\n\n",""])},3:function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var o,r=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?t:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")})}},375:function(t,e,n){"use strict";function i(){var t=function(t){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var e=function(t){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(t,e,n,i){THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1,i=i||0;for(var o=this,r=0,a=t.length;r<a;r+=3)w(new THREE.Vector3(t[r],t[r+1],t[r+2]));var s=this.vertices,c=[],l=(r=0,0);for(a=e.length;r<a;r+=3,l++){var h=s[e[r]],u=s[e[r+1]],E=s[e[r+2]];c[l]=new THREE.Face3(h.index,u.index,E.index,[h.clone(),u.clone(),E.clone()])}var p=new THREE.Vector3;for(r=0,a=c.length;r<a;r++)g(c[r],i);for(r=0,a=this.faceVertexUvs[0].length;r<a;r++){var d=this.faceVertexUvs[0][r],m=d[0].x,f=d[1].x,v=d[2].x,T=Math.max(m,Math.max(f,v)),y=Math.min(m,Math.min(f,v));T>.9&&y<.1&&(m<.2&&(d[0].x+=1),f<.2&&(d[1].x+=1),v<.2&&(d[2].x+=1))}for(r=0,a=this.vertices.length;r<a;r++)this.vertices[r].multiplyScalar(n);function w(t){var e=t.normalize().clone();e.index=o.vertices.push(e)-1;var n=H(t)/2/Math.PI+.5,i=function(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(t)/Math.PI+.5;return e.uv=new THREE.Vector2(n,1-i),e}function R(t,e,n){var i=new THREE.Face3(t.index,e.index,n.index,[t.clone(),e.clone(),n.clone()]);o.faces.push(i),p.copy(t).add(e).add(n).divideScalar(3);var r=H(p);o.faceVertexUvs[0].push([M(t.uv,t,r),M(e.uv,e,r),M(n.uv,n,r)])}function g(t,e){for(var n=Math.pow(2,e),i=(Math.pow(4,e),w(o.vertices[t.a])),r=w(o.vertices[t.b]),a=w(o.vertices[t.c]),s=[],c=0;c<=n;c++){s[c]=[];for(var l=w(i.clone().lerp(a,c/n)),h=w(r.clone().lerp(a,c/n)),u=n-c,E=0;E<=u;E++)s[c][E]=0==E&&c==n?l:w(l.clone().lerp(h,E/u))}for(c=0;c<n;c++)for(E=0;E<2*(n-c)-1;E++){var p=Math.floor(E/2);E%2==0?R(s[c][p+1],s[c+1][p],s[c][p]):R(s[c][p+1],s[c+1][p+1],s[c+1][p])}}function H(t){return Math.atan2(t.z,-t.x)}function M(t,e,n){return n<0&&1===t.x&&(t=new THREE.Vector2(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new THREE.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(t,e){this.parameters={radius:t,detail:e};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(t,e,n,i,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:o},t=t||100,e=e||40,n=n||8,i=i||6,o=o||2*Math.PI;for(var r=new THREE.Vector3,a=[],s=[],c=0;c<=n;c++)for(var l=0;l<=i;l++){var h=l/i*o,u=c/n*Math.PI*2;r.x=t*Math.cos(h),r.y=t*Math.sin(h);var E=new THREE.Vector3;E.x=(t+e*Math.cos(u))*Math.cos(h),E.y=(t+e*Math.cos(u))*Math.sin(h),E.z=e*Math.sin(u),this.vertices.push(E),a.push(new THREE.Vector2(l/i,c/n)),s.push(E.clone().sub(r).normalize())}for(c=1;c<=n;c++)for(l=1;l<=i;l++){var p=(i+1)*c+l-1,d=(i+1)*(c-1)+l-1,m=(i+1)*(c-1)+l,f=(i+1)*c+l,v=new THREE.Face3(p,d,f,[s[p].clone(),s[d].clone(),s[f].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[d].clone(),a[f].clone()]),v=new THREE.Face3(d,m,f,[s[d].clone(),s[m].clone(),s[f].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[d].clone(),a[m].clone(),a[f].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var n=function(t,e,n){var i=new THREE.Geometry;n=n||1;for(var o=0;o<=64*n;++o)"x"==e&&i.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(t)),"y"==e&&i.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(t)),"z"==e&&i.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(t));return i},i=function(t,e,n,i,o,r){var a=new THREE.Geometry,s=new THREE.Mesh(new THREE.CylinderGeometry(t,e,n,i,o,r));return s.position.y=.5,s.updateMatrix(),a.merge(s.geometry,s.matrix),a},o=function(t){var e=new THREE.Geometry;return"X"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===t&&e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),e};THREE.TransformGizmo=function(){var t=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var t=new THREE.PlaneBufferGeometry(50,50,2,2),e=new THREE.MeshBasicMaterial({wireframe:!0});e.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(t,e),YZ:new THREE.Mesh(t,e),XZ:new THREE.Mesh(t,e),XYZE:new THREE.Mesh(t,e)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(t){if(t instanceof THREE.Mesh){t.updateMatrix();var e=new THREE.Geometry;t.geometry instanceof THREE.BufferGeometry&&(t.geometry=(new THREE.Geometry).fromBufferGeometry(t.geometry)),e.merge(t.geometry,t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(t){t.visible=!1})},this.show=function(){this.traverse(function(e){e.visible=!0,e.parent!=t.pickers&&e.parent!=t.hemiPicker||(e.visible=!1),e.parent==t.planes&&(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(t){this.traverse(function(e){e.material&&e.material.highlight&&(e.name==t?e.material.highlight(!0):e.material.highlight(!1))})},this.setupGizmos=function(){var t=function(t,e){for(var n in t)for(var i=t[n].length;i--;){var o=t[n][i][0],r=t[n][i][1],a=t[n][i][2],s=t[n][i][3];o.name=n,r&&o.position.set(r[0],r[1],r[2]),a&&o.rotation.set(a[0],a[1],a[2]),s&&(o.visble=s),e.add(o)}};this.setHandlePickerGizmos(),t(this.handleGizmos,this.handles),t(this.pickerGizmos,this.pickers),t(this.highlightGizmos,this.highlights),t(this.hemiPickerGizmos,this.hemiPicker),t(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(t,e){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse(function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(e,n,i)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(t))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=i(0,.05,.2,12,1,!1),r=o("X"),a=o("Y"),s=o("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new e({color:15805484}))]],Y:[[new THREE.Mesh(n,new t({color:768011})),[0,.5,0]],[new THREE.Line(a,new e({color:768011}))]],Z:[[new THREE.Mesh(n,new t({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(s,new e({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new t({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new t({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new t({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(t,e){var n=new THREE.Matrix4;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(n(1,"x",.5),new e({color:16711680}))]],RY:[[new THREE.Line(n(1,"y",.5),new e({color:65280}))]],RZ:[[new THREE.Line(n(1,"z",.5),new e({color:255}))]],RE:[[new THREE.Line(n(1.25,"z",1),new e({color:65535}))]],RXYZE:[[new THREE.Line(n(1,"z",1),new e({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new t({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new t({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(t){"RE"==t&&(this.activePlane=this.planes.XYZE),"RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse(function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var e=this;this.setHandlePickerGizmos=function(){var e=i(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(e,new t({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new t({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new t({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new t({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new t({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new t({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new t({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new t({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new t({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new t({color:255})),null,null,!1]]}},this.setActivePlane=function(t,e){if("translate"==this.activeMode){var n=new THREE.Matrix4;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(t,e){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse(function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))})}},this.show=function(){this.traverse(function(t){(null==e.parent||e.parent.useAllPickers||t.parent!=e.handles)&&(t.visible=!0),t.material&&(t.material.opacity=t.material.oldOpacity),t.parent!=e.pickers&&t.parent!=e.hemiPicker&&t.parent!=e.subPickers||(t.visible=!1),t.parent!=e.planes&&t.parent!=e.highlights||(t.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(t){this.traverse(function(n){n.material&&n.material.highlight&&(n.name==t?(n.parent!=e.highlights&&n.parent!=e.handles||(n.visible=!0),n.material.highlight(!0)):(n.material.highlight(!1),n.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=i(.125,.125,.125),r=o("X"),a=o("Y"),s=o("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(r,new e({color:16711680}))]],Y:[[new THREE.Mesh(n,new t({color:65280})),[0,.5,0]],[new THREE.Line(a,new e({color:65280}))]],Z:[[new THREE.Mesh(n,new t({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(s,new e({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new t({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new t({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(t,e){var n=new THREE.Matrix4;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(t,e,n){switch(THREE.Object3D.call(this),e=void 0!==e?e:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var i=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(o,i);var o=new THREE.Geometry;i=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,i);o=new THREE.Geometry,i=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,i),(r=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=r.minFilter=THREE.NearestFilter;var r;o=new THREE.CircleGeometry(.1,32),i=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:r});this.centerMark=new THREE.Mesh(o,i),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(r=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=r.minFilter=THREE.NearestFilter;i=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:r});var a=.25;this.ticks.RX=new THREE.Object3D;o=new THREE.PlaneBufferGeometry(.12,a);var s=new THREE.Mesh(o,i);s.position.set(0,0,-1.275),s.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(s),(s=s.clone()).position.set(0,-1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),this.ticks.RY=new THREE.Object3D,(s=s.clone()).position.set(0,0,-1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(-1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s)}var c=this,l=!1,h=n,u={type:"change"},E={type:"mouseDown"},p={type:"mouseUp",mode:h},d={type:"objectChange"},m=(new THREE.Raycaster,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),f=new THREE.Vector3,v=new THREE.Vector3,T=new THREE.Vector3,y=1;this.clientScale=1;var w=new THREE.Matrix4,R=new THREE.Vector3,g=new THREE.Matrix4,H=new THREE.Vector3,M=new THREE.Quaternion,x=new THREE.Vector3,b=new THREE.Vector3,P=new THREE.Vector3,S=new THREE.Quaternion,V=new THREE.Quaternion,z=new THREE.Quaternion,I=new THREE.Quaternion,k=new THREE.Quaternion,A=new THREE.Vector3,G=new THREE.Vector3,B=new THREE.Matrix4,C=new THREE.Matrix4,O=new THREE.Vector3,j=new THREE.Vector3,X=new THREE.Euler,Y=new THREE.Matrix4,L=new THREE.Vector3;new THREE.Euler;function Z(e,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,n,t,!0)}this.attach=function(t){c.object=t,this.gizmo[h].show(),c.update(),c.updateUnitVectors()},this.detach=function(t){c.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(t){"scale"==(h=t||h)&&(c.space="local"),this.gizmo[h].show(),this.update(),c.dispatchEvent(u)},this.getPicker=function(){return c.gizmo[h].hemiPicker.children},this.setPosition=function(t){this.object.position.copy(t),this.update()},this.setNormal=function(t){M.setFromUnitVectors(this.normal,t),this.unitX.applyQuaternion(M),this.unitY.applyQuaternion(M),this.unitZ.applyQuaternion(M),this.normal.copy(t),this.object&&this.object.quaternion.multiply(M),this.update()},this.setSnap=function(t,e){c.snap=t,c.snapDelta=e},this.setSize=function(t){c.size=t,this.update(),c.dispatchEvent(u)},this.setSpace=function(t){c.space=t,this.update(),c.dispatchEvent(u)},this.update=function(n){if(void 0!==c.object){var i;if(c.object.updateMatrixWorld(),j.setFromMatrixPosition(c.object.matrixWorld),X.setFromRotationMatrix(g.extractRotation(c.object.matrixWorld)),t.updateMatrixWorld(),L.setFromMatrixPosition(t.matrixWorld),this.position.copy(j),this.quaternion.setFromEuler(X),this.normal.set(0,0,1),this.normal.applyEuler(X),t.isPerspective){var o=j.distanceTo(L);i=2*Math.tan(t.fov*Math.PI/360)*o}else i=t.top-t.bottom;var r=e.getBoundingClientRect();y=100*this.clientScale*i/r.height,this.scale.set(y,y,y),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),n&&this.gizmo[h].highlight(c.axis)}},this.setGizmoOffset=function(t){this.gizmoOffset=t||new THREE.Vector3(0,0,0),this.update()},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(X),this.unitY.applyEuler(X),this.unitZ.applyEuler(X)},this.showRotationGizmos=function(t){for(var e=this.gizmo[h].handles.children,n=0;n<e.length;n++){var i=e[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=t)}this.useAllPickers=t},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(t){if(void 0===c.object||!0===l)return!1;var e=Z(t,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children),n=null,i="";return e&&(i=-1!=(n=e.object.name).search("R")?"rotate":"translate"),c.axis!==n&&(c.axis=n,c.gizmo[h].activeMode=i,c.update(!0),c.dispatchEvent(u)),null===c.axis&&c.gizmo[h].show(),!!e},this.onPointerDown=function(e){if(void 0===c.object||!0===l)return!1;var n=e;if("touch"===e.pointerType){var i=null,o="";(r=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))&&(o=-1!=(i=r.object.name).search("R")?"rotate":"translate"),c.axis!==i&&(c.axis=i,c.gizmo[h].activeMode=o)}var r=null;if((0===n.button||-1===n.button||void 0===n.button)&&(r=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))){c.dispatchEvent(E),c.axis=r.object.name,c.update(),R.copy(t.position).sub(j).normalize(),c.gizmo[h].setActivePlane(c.axis,R);var a=Z(n,[c.gizmo[h].activePlane]);if(a&&f.copy(a.point),A.copy(c.object.position),G.copy(c.object.scale),B.extractRotation(c.object.matrix),Y.extractRotation(c.object.matrixWorld),c.object.parent?(C.extractRotation(c.object.parent.matrixWorld),O.setFromMatrixScale(g.getInverse(c.object.parent.matrixWorld))):(C.extractRotation(c.object.matrixWorld),O.setFromMatrixScale(g.getInverse(c.object.matrixWorld))),"transrotate"===h&&"rotate"===c.gizmo[h].activeMode){c.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(c.matrixWorld),c.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(c.matrixWorld),c.startLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.startLine);var s=c.object.geometry.getAttribute("position"),u=(new THREE.Vector3).fromAttribute(s,0).applyMatrix4(c.object.matrixWorld),p=(new THREE.Vector3).fromAttribute(s,1).applyMatrix4(c.object.matrixWorld),d=(new THREE.Vector3).fromAttribute(s,2).applyMatrix4(c.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(s,3).applyMatrix4(c.object.matrixWorld);if("RX"===c.axis){u.lerp(d,.5),p.lerp(m,.5);var v=u.distanceTo(p);c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(p)}else{u.lerp(p,.5),d.lerp(m,.5);v=u.distanceTo(d);c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(d)}c.centerLine.geometry.computeLineDistances(),c.centerLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.centerLine),c.ticks[c.axis].position.copy(c.position),c.ticks[c.axis].quaternion.copy(c.quaternion),c.ticks[c.axis].scale.copy(c.scale),c.parent.add(c.ticks[c.axis])}}return l=!0,!!r},this.onPointerMove=function(t){if(void 0===c.object||null===c.axis||!1===l)return!1;var e=Z(t,[c.gizmo[h].activePlane]);e&&m.copy(e.point);var n=c.gizmo[h].activeMode;if("translate"==n)m.sub(f),m.multiply(O),"local"==c.space&&(m.applyMatrix4(g.getInverse(Y)),x.copy(this.unitX),b.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(x.multiplyScalar(m.dot(this.unitX)),H.add(x)),-1!=c.axis.search("Y")&&(b.multiplyScalar(m.dot(this.unitY)),H.add(b)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(B),c.object.position.copy(A),c.object.position.add(m)),"world"!=c.space&&-1==c.axis.search("XYZ")||(x.copy(this.unitX),b.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(x.multiplyScalar(m.dot(this.unitX)),H.add(x)),-1!=c.axis.search("Y")&&(b.multiplyScalar(m.dot(this.unitY)),H.add(b)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(g.getInverse(C)),c.object.position.copy(A),c.object.position.add(m));else if("scale"==n)m.sub(f),m.multiply(O),"local"==c.space&&("XYZ"==c.axis?(y=1+m.y/50,c.object.scale.x=G.x*y,c.object.scale.y=G.y*y,c.object.scale.z=G.z*y):(m.applyMatrix4(g.getInverse(Y)),"X"==c.axis&&(c.object.scale.x=G.x*(1+m.x/50)),"Y"==c.axis&&(c.object.scale.y=G.y*(1+m.y/50)),"Z"==c.axis&&(c.object.scale.z=G.z*(1+m.z/50))));else if("rotate"==n){if(m.sub(j),m.multiply(O),H.copy(f).sub(j),H.multiply(O),"RE"==c.axis){m.applyMatrix4(g.getInverse(w)),H.applyMatrix4(g.getInverse(w)),v.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),T.set(Math.atan2(H.z,H.y),Math.atan2(H.x,H.z),Math.atan2(H.y,H.x)),M.setFromRotationMatrix(g.getInverse(C));var i=v.z-T.z;if(null!==c.snap){var o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}k.setFromAxisAngle(R,i),S.setFromRotationMatrix(Y),M.multiplyQuaternions(M,k),M.multiplyQuaternions(M,S),c.object.quaternion.copy(M)}else if("RXYZE"==c.axis){var r=m.clone().cross(H).normalize();M.setFromRotationMatrix(g.getInverse(C));var a=-m.clone().angleTo(H);if(null!==c.snap){o=Math.round(a/c.snap)*c.snap;Math.abs(o-a)<c.snapDelta&&(a=o)}V.setFromAxisAngle(r,a),S.setFromRotationMatrix(Y),M.multiplyQuaternions(M,V),M.multiplyQuaternions(M,S),c.object.quaternion.copy(M)}else if("local"==c.space){m.applyMatrix4(g.getInverse(Y)),H.applyMatrix4(g.getInverse(Y));var s=m.dot(this.unitX),E=m.dot(this.unitY),p=m.dot(this.unitZ),X=H.dot(this.unitX),L=H.dot(this.unitY),_=H.dot(this.unitZ);v.set(Math.atan2(p,E),Math.atan2(s,p),Math.atan2(E,s)),T.set(Math.atan2(_,L),Math.atan2(X,_),Math.atan2(L,X));var U=v.x-T.x,D=v.y-T.y;i=v.z-T.z;if(null!==c.snap){if(-1!=c.axis.search("X")){o=Math.round(U/c.snap)*c.snap;Math.abs(o-U)<c.snapDelta&&(U=o)}if(-1!=c.axis.search("Y")){o=Math.round(D/c.snap)*c.snap;Math.abs(o-D)<c.snapDelta&&(D=o)}if(-1!=c.axis.search("Z")){o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}}V.setFromAxisAngle(this.unitX,U),z.setFromAxisAngle(this.unitY,D),I.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(B),"RX"==c.axis&&S.multiplyQuaternions(S,V),"RY"==c.axis&&S.multiplyQuaternions(S,z),"RZ"==c.axis&&S.multiplyQuaternions(S,I),c.object.quaternion.copy(S)}else if("world"==c.space){s=m.dot(this.unitX),E=m.dot(this.unitY),p=m.dot(this.unitZ),X=H.dot(this.unitX),L=H.dot(this.unitY),_=H.dot(this.unitZ);v.set(Math.atan2(p,E),Math.atan2(s,p),Math.atan2(E,s)),T.set(Math.atan2(_,L),Math.atan2(X,_),Math.atan2(L,X)),M.setFromRotationMatrix(g.getInverse(C));U=v.x-T.x,D=v.y-T.y,i=v.z-T.z;if(null!==c.snap){if(-1!=c.axis.search("X")){o=Math.round(U/c.snap)*c.snap;Math.abs(o-U)<c.snapDelta&&(U=o)}if(-1!=c.axis.search("Y")){o=Math.round(D/c.snap)*c.snap;Math.abs(o-D)<c.snapDelta&&(D=o)}if(-1!=c.axis.search("Z")){o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}}V.setFromAxisAngle(this.unitX,U),z.setFromAxisAngle(this.unitY,D),I.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(Y),"RX"==c.axis&&M.multiplyQuaternions(M,V),"RY"==c.axis&&M.multiplyQuaternions(M,z),"RZ"==c.axis&&M.multiplyQuaternions(M,I),M.multiplyQuaternions(M,S),c.object.quaternion.copy(M)}"transrotate"===h&&(c.add(c.endLine),c.add(c.centerMark))}return c.object.matrixAutoUpdate=!0,c.update(!0),c.dispatchEvent(u),c.dispatchEvent(d),!!e},this.onPointerUp=function(t){return l&&null!==c.axis&&(p.mode=h,c.dispatchEvent(p)),l=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.intersectObjects=function(){var t=new THREE.Vector3,e=new THREE.Vector3,n=new THREE.Raycaster;return function(i,o,r,a,s){var c=i/a.clientWidth*2-1,l=-o/a.clientHeight*2+1;a.isPerspective?(t.set(c,l,.5),t.unproject(a),n.set(a.position,t.sub(a.position).normalize())):(t.set(c,l,-1),t.unproject(a),e.set(0,0,-1),n.set(t,e.transformDirection(a.matrixWorld)));var h=n.intersectObjects(r,s);return h[0]?h[0]:null}}(),THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}function o(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.r(e);var r=null,a=function(t,e){var n,a,s,c=t.impl,l=["section"],h=!1,u=!1,E=!1,p=!0,d=e.tintColor,m=e.tintIntensity,f=[],v=[],T=[],y="",w="gizmo",R=null,g=!1,H=!0,M=[[0,1],[1,3],[3,2],[2,0]],x=.25,b=2653930;function P(){c.invalidate(!1,!1,!0)}function S(){n&&n.update(),a&&a.update()}function V(){h&&1===v.length&&(B(!0),S(),I((new THREE.Plane).setComponents(v[0].x,v[0].y,v[0].z,v[0].w)))}i(),function(){if(r)return;(r=function(t,e,n){THREE.Mesh.call(this,t,e,!1),this.plane=n,this.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),this.connectivity=[],this.outlines=[]}).prototype=Object.create(THREE.Mesh.prototype),r.prototype.constructor=r,r.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var t=this.plane.normal,e=-1*this.getWorldPosition().dot(t);this.planeVec.set(t.x,t.y,t.z,e),this.plane.constant=e}}();var z=new function(t,e){var n,i,o,r,a,s,l,h=0,u=[],E=[];function p(t){h&&clearTimeout(h),h=0,i=t,u.length=0,E.length=0,r=null,a=-1,s=0,l=0}function d(){h=0;for(var r=performance.now()+t;performance.now()<r;){if(!v())return c.invalidate(!0,!0),void p(null);n(E[l],u[s],o,l+1>=E.length,!i||a>=i.length)}h=setTimeout(d,e)}function m(){if(i&&a<i.length)for(;++a<i.length;)if((r=i[a].getInstanceTree())&&(u.length=0,r.enumNodeChildren(i[a].getRootId(),function(t){u.push(t)},!0),u.length>0))return o=i[a];return o=null,!1}function f(){if(s>=u.length)return!1;for(;++s<u.length;){var t=u[s];if(!r.isNodeHidden(t)&&!r.isNodeOff(t)&&(E.length=0,r.enumNodeFragments(t,function(t){E.push(t)},!1),E.length>0))return!0}return!1}function v(){if(++l<E.length)return!0;for(l=0;;){if(f())return!0;if(!m())return!1;s=-1}}t=t||15,e=e||0,this.start=function(t,e,i){p(t),n=i,i&&(e>=0?h=setTimeout(d,e):d())}};function I(t){var e=Autodesk.Viewing.Extensions.CompGeom,n=c.sceneAfter.getObjectByName("section");n&&c.sceneAfter.remove(n);var i=new THREE.Object3D;i.name="section",c.sceneAfter.add(i);var o=new THREE.Object3D;i.add(o);var r=new THREE.Object3D;i.add(r);var a=Autodesk.Viewing.Private,s=e.makePlaneBasis(t),l=(new THREE.Matrix4).getInverse(s),h=c.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0},!1,!1),u=c.matman().findMaterial(null,h);u.transparent=!0,u.depthTest=!0,u.polygonOffset=!0,u.polygonOffsetFactor=-1,u.polygonOffsetUnits=.1,u.cutplanes=A;var E,p=new THREE.Box3,f=c.modelQueue().getModels(),v=[];z.start(f,50,function(n,i,h,f){var T=h.getFragmentList();if(T.getWorldBounds(n,p),e.xBoxPlane(t,p)){var y=T.getVizmesh(n);y.geometry&&!y.geometry.is2d&&!y.geometry.isLines&&y.material.cutplanes&&(E=y.material,e.xMeshPlane(t,y,v))}if(f){if(v.length){var w=new THREE.Box3;e.convertToPlaneCoords(s,v,w);var R=new a.VertexBufferBuilder(!1,8*v.length),g=function(t){return t&&t.color||new THREE.Color(16777215)}(E),H=0|.25*g.r*255.5,M=0|.25*g.g*255.5,x=4278190080|(0|.25*g.b*255.5)<<16|M<<8|H,b=new e.EdgeSet(v,w,1e-6*w.size().length());b.snapEdges(),b.sanitizeEdges(),b.stitchContours();var P=b.triangulate();if(P){for(var S=0;S<P.contours.length;S++)for(var V=P.contours[S],z=1;z<V.length;z++){var I=P.pts[V[z-1]],k=P.pts[V[z]];R.addSegment(I.x,I.y,k.x,k.y,0,-2,x,i,0)}var G={mesh:R.toMesh()};a.BufferGeometryUtils.meshToGeometry(G);var B=G.geometry;B.streamingDraw=!0,B.streamingIndex=!0;var C=new THREE.Mesh(B,u);if(C.matrix.copy(l),C.matrixAutoUpdate=!1,C.frustumCulled=!1,C.modelId=h.id,C.dbId=i,r.add(C),!P.triangulationFailed){var O=P.toPolygonMesh(E.packedNormals),j=c.matman().cloneMaterial(E,h);j.packedNormals=E.packedNormals,j.cutplanes=A,j.side=THREE.FrontSide,j.depthTest=!0,j.map=null,j.bumpMap=null,j.normalMap=null,j.alphaMap=null,j.specularMap=null,j.transparent=!1,j.depthWrite=!0,j.hatchPattern=!0,j.needsUpdate=!0;var X=(E.id+2)*Math.PI*.125,Y=Math.tan(X);j.hatchParams=new THREE.Vector2(Y,10),j.hatchTintColor=d,j.hatchTintIntensity=m,null!=j.prismType&&(j.defines={},j.defines[j.prismType.toUpperCase()]="","PrismWood"==j.prismType&&(j.defines.NO_UVW=""));var L=new THREE.Mesh(O,j);L.matrix.copy(l),L.matrixAutoUpdate=!1,L.modelId=h.id,L.dbId=i,L.fragId=v.fragId,o.add(L)}}}v.length=0}})}var k="Autodesk.Viewing.Extension.Section.SectionTool";c.setCutPlaneSetFor2DRendering(k);var A=[];function G(t,e){var n,i,o=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),t.normal);if(e){var a=t.projectPoint(e.max),s=t.projectPoint(e.min),l=o.clone().inverse();a.applyQuaternion(l),s.applyQuaternion(l),i=(new THREE.Vector3).subVectors(a,s),n=new THREE.PlaneBufferGeometry(i.x,i.y)}else i=2*(e=c.getVisibleBounds()).getBoundingSphere().radius,n=new THREE.PlaneBufferGeometry(i,i);var h=new THREE.MeshBasicMaterial({opacity:0,color:b,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),u=new r(n,h,t),E=t.projectPoint(e.center());u.position.copy(E),u.quaternion.multiply(o);var p=c.currentLightPreset();p=Math.max(0,p);for(var d=Autodesk.Viewing.Private.LightPresets[p].bgColorGradient,m="rgb("+(255-d[0])+","+(255-d[1])+","+(255-d[2])+")",f=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),v=u.geometry.getAttribute("position"),T=0;T<M.length;T++){(n=new THREE.Geometry).vertices.push((new THREE.Vector3).fromArray(v.array,M[T][0]*v.itemSize),(new THREE.Vector3).fromArray(v.array,M[T][1]*v.itemSize));var y=new THREE.Line(n,f);u.add(y),u.outlines.push(y)}return u}function B(t){C(function(e){var n,i,o,a;if(e instanceof r)if(e.connectivity.length>0){var s=(new THREE.Matrix4).getInverse(e.matrixWorld);for(a=new THREE.Vector3,o=e.geometry.getAttribute("position"),n=0;n<o.length/o.itemSize;n++){var l=e.connectivity[n];null!==U(e.plane,l[0],l[1],a)&&(a.applyMatrix4(s),o.setXYZ(n,a.x,a.y,a.z))}for(o.needsUpdate=!0,e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere(),n=0;n<e.outlines.length;n++)(i=e.outlines[n]).geometry.vertices[0].fromArray(o.array,M[n][0]*o.itemSize),i.geometry.vertices[1].fromArray(o.array,M[n][1]*o.itemSize),i.geometry.verticesNeedUpdate=!0}else if(t){var h=c.getVisibleBounds(),u=2*h.getBoundingSphere().radius;for(a=e.plane.projectPoint(h.center()),e.geometry=new THREE.PlaneBufferGeometry(u,u),e.position.copy(a),o=e.geometry.getAttribute("position"),n=0;n<e.outlines.length;n++)(i=e.outlines[n]).geometry.vertices[0].fromArray(o.array,M[n][0]*o.itemSize),i.geometry.vertices[1].fromArray(o.array,M[n][1]*o.itemSize),i.geometry.verticesNeedUpdate=!0}})}function C(t){for(var e=0;e<f.length;e++)f[e].traverse(t)}function O(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];C(function(t){t instanceof r&&t.update()}),1===v.length&&I((new THREE.Plane).setComponents(v[0].x,v[0].y,v[0].z,v[0].w)),c.setCutPlaneSet(k,v,t)}function j(t){for(var e=0;e<f.length;e++)f[e].visible=t;p!==t&&P(),p=t}function X(t){t&&v.length>0&&(1===v.length&&I((new THREE.Plane).setComponents(v[0].x,v[0].y,v[0].z,v[0].w)),c.setCutPlaneSet(k,v)),j(t)}function Y(t,e){t.attach(e),t.setPosition(e.position),t.visible=!0}function L(t){return c.api.navigation.getEyeVector().dot(t)>0&&t.negate(),t}function Z(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=c.getVisibleBounds().center(),r=new THREE.Group;e=void 0!==e?e:-1*o.dot(t);var a=G(new THREE.Plane(t,e),null);r.add(a),v.push(a.planeVec),f.push(r),c.addOverlay(w,r),n&&(Y(n,a),a.material.opacity=x,_(a),n.showRotationGizmos(!0),T=n.getPicker()),O(i)}function _(t){if(!n||!t)return!1;var e=function(t){var e=new THREE.Vector3,n=t.geometry;return n.computeBoundingBox(),e.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,e.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,e.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,t.localToWorld(e),e}(t).sub(t.position);return e.sub(s),n.setGizmoOffset(e),!0}var U=function(){var t=new THREE.Matrix3,e=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3;return function(o,r,a,s){t.set(o.normal.x,o.normal.y,o.normal.z,r.normal.x,r.normal.y,r.normal.z,a.normal.x,a.normal.y,a.normal.z);var c=t.determinant();return 0===c?null:(e.crossVectors(r.normal,a.normal).multiplyScalar(-o.constant),n.crossVectors(a.normal,o.normal).multiplyScalar(-r.constant),i.crossVectors(o.normal,r.normal).multiplyScalar(-a.constant),(s||new THREE.Vector3).copy(e).add(n).add(i).divideScalar(c))}}(),D=function(t,e,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,e,c.camera,n)};this.isActive=function(){return h},this.getSectionDistance=function(t){var e=c.api.navigation.getEyeVector(),n=c.rayIntersect(new THREE.Ray(c.camera.position,e));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(t)},this.setViewerSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.clearSection(t);var e=c.getCutPlaneSet("__set_view");if(1===e.length){n.clientScale=1;var i=e[0];Z(new THREE.Vector3(i.x,i.y,i.z),i.w,t),y="SET_VIEW_PLANE",c.setCutPlaneSet("__set_view",void 0,t)}},this.setSection=function(t){var e,i;this.clearSection(),s=new THREE.Vector3,n.clientScale=1;var o=c.getCutPlaneSet("__set_view");switch(1===o.length&&"BOX"!==t&&"OBJ_SET_VIEW_PLANE"!==t&&(t="SET_VIEW_PLANE"),t){case"X":e=new THREE.Vector3(1,0,0),i=this.getSectionDistance(e),Z(L(e),i);break;case"Y":e=new THREE.Vector3(0,1,0),i=this.getSectionDistance(e),Z(L(e),i);break;case"Z":e=new THREE.Vector3(0,0,1),i=this.getSectionDistance(e),Z(L(e),i);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var r=o[0];Z(e=new THREE.Vector3(r.x,r.y,r.z),r.w);break;case"OBJ_BOX":case"BOX":!function(t){var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],i=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],o=new THREE.Group,r=c.getVisibleBounds(),s=r.center(),l=new THREE.Box3(r.min,s),h=!1;t&&6===t.length&&1===t[0].x&&(s=(l=new THREE.Box3(new THREE.Vector3(t[3].w,t[4].w,t[5].w),new THREE.Vector3(t[0].w,t[1].w,t[2].w))).max.clone(),h=!0);var u,E,p=[],d=[];for(u=0;u<e.length;u++){if(h){var m=new THREE.Plane(e[u],t[u].w);p.push(m)}else if(m=new THREE.Plane(e[u],-1*s.dot(e[u])),p.push(m),u>2){var y=m.orthoPoint(l.max),R=m.orthoPoint(l.min),g=(new THREE.Vector3).subVectors(y,R);m.constant-=g.length()}E=G(m,l),o.add(E),d.push(E),v.push(E.planeVec)}for(u=0;u<d.length;u++){E=d[u];for(var H=i[u],M=0;M<H.length;M++){for(var b=[],P=H[M],S=0;S<P.length;S++)b.push(p[P[S]]);E.connectivity.push(b)}}f.push(o),c.addOverlay(w,o),O(),B(),m=f[0].children[0],Y(n,m),m.material.opacity=x,_(m),Y(a,f[0]),n.showRotationGizmos(!1),T=n.getPicker().concat(a.getPicker());var V=f[0].position.clone().sub(s.clone());a.setGizmoOffset(V)}(o),n.clientScale=2,this.recomputePivot()}y=t,c.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(t){this.clearSection(),Z(new THREE.Vector3(t.x,t.y,t.z),t.w),y="",c.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(t){y=t||""},this.clearSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(n&&n.detach(),a&&a.detach();v.length>0;)v.pop();for(;f.length>0;){var e=f.pop();c.removeOverlay(w,e)}z.start(null);var i=c.sceneAfter.getObjectByName("section");i&&c.sceneAfter.remove(i),c.setCutPlaneSet(k,null,t)},this.isPlaneOn=function(){return p},this.showPlane=function(t){j(t)},this.attachControl=function(t){n&&a&&(t?(Y(n,f[0].children[0]),n.highlight(),"BOX"===y&&Y(a,f[0])):(n.detach(),a.detach()))},this.resetSection=function(){this.setSection(y)},this.getNames=function(){return l},this.getName=function(){return l[0]},this.register=function(){},this.deregister=function(){this.clearSection(),g&&(c.removeOverlay(w,n),n.removeEventListener("change",P),n=null,c.removeOverlay(w,a),a.removeEventListener("change",P),a=null,c.removeOverlayScene(w),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,S),t.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,V),t.removeEventListener(Autodesk.Viewing.HIDE_EVENT,V),t.removeEventListener(Autodesk.Viewing.SHOW_EVENT,V),g=!1)},this.getPriority=function(){return 70},this.activate=function(){g||((n=new THREE.TransformControls(c.camera,c.canvas,"transrotate")).addEventListener("change",P),n.setSnap(Math.PI/2,Math.PI/36),(a=new THREE.TransformControls(c.camera,c.canvas,"translate")).addEventListener("change",P),void 0===c.overlayScenes[w]&&c.createOverlayScene(w),c.addOverlay(w,n),c.addOverlay(w,a),t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,S),t.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,V),t.addEventListener(Autodesk.Viewing.HIDE_EVENT,V),t.addEventListener(Autodesk.Viewing.SHOW_EVENT,V),g=!0),h=!0,u=!1,H=!0,v=v||[],X(!0)},this.deactivate=function(){h=!1,u=!1,z.start(null);var t=c.sceneAfter.getObjectByName("section");t&&c.sceneAfter.remove(t),X(!1),c.setCutPlaneSet(k),n.detach(),a.detach()},this.update=function(){return!1},this.handleSingleClick=function(t){var e=D(t,f[0].children);return f[0].children.forEach(function(t){t.material.opacity=0}),e&&(Y(n,e.object),n.highlight(),e.object.material.opacity=x,_(e.object),P()),!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(t){return this.handleSingleClick(t,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(t){return u=!0,!!a.onPointerDown(t)||n.onPointerDown(t)},this.handleButtonUp=function(t){return u=!1,E&&(E=!1,this.recomputePivot()),!!a.onPointerUp(t)||n.onPointerUp(t)},this.handleMouseMove=function(t){var e=a.object?(new THREE.Vector3).copy(a.object.position):null;if(u){if(a.onPointerMove(t)){E=!0,O(),n.update();var i=(new THREE.Vector3).copy(a.object.position).sub(e);return s.add(i),!0}if(n.onPointerMove(t))return E=!0,O(),B(),!0}if(a.visible=void 0!==a.object,"touch"!==t.pointerType){var o=t,r=D(o,f[0].children);r&&(H=!1);var c=!!(H||r||D(o,T,!0));n.visible=c,a.visible=a.visible&&c,j(c)}return!!a.onPointerHover(t)||n.onPointerHover(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":return R="drag",this.handleButtonDown(t,0);case"dragmove":return"drag"===R&&this.handleMouseMove(t);case"dragend":return"drag"===R&&(R=null,this.handleButtonUp(t,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!0},this.recomputePivot=function(){var t=this.getSectionBoxValues(!0);if(t){var e=t.sectionBox;c.api.navigation.setPivotPoint(new THREE.Vector3(e[0]+.5*(e[3]-e[0]),e[1]+.5*(e[4]-e[1]),e[2]+.5*(e[5]-e[2])))}},this.getSectionBoxValues=function(t){var e=f[0];if(!e)return null;var n=e.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,r=n[2].position.z,a=n[3].position.x,s=n[4].position.y,l=n[5].position.z,h={x:0,y:0,z:0};return t||(h=c.model.getData().globalOffset||h),{sectionBox:[Math.min(a,i)+h.x,Math.min(o,s)+h.y,Math.min(r,l)+h.z,Math.max(a,i)+h.x,Math.max(o,s)+h.y,Math.max(r,l)+h.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(t){var e=f[0];if(!e)return null;var n=e.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};t||(i=c.model.getData().globalOffset||i);var o=n[0].plane,r=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,r]}},this.getSectionPlaneSet=function(){return c.getCutPlaneSet(k)},this.getSectionPlanes=function(){var t=[];return["__set_view",k].forEach(function(e){var n=c.getCutPlaneSet(e);n.length>0&&t.push.apply(t,o(n))}),t},this.notifyCutplanesChanged=function(){var t=A.length;A.length=0;for(var e=c.getCutPlaneSets(),n=0;n<e.length;n++){var i=e[n];if(i!==k)for(var o=c.getCutPlaneSet(i),r=0;r<o.length;r++)A.push(o[r])}e.includes("__set_view")&&""!==y&&-1===y.indexOf("OBJ_")&&this.setViewerSection(!1),t!==A.length&&function(){var t=c.sceneAfter.getObjectByName("section");t&&t.traverse(function(t){!t instanceof THREE.Mesh||!t.material||(t.material.needsUpdate=!0)})}()},this.setSectionBox=function(t){if(!t)return!1;var e=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(t,t.transform);return y="OBJ_BOX",c.setCutPlaneSet("__set_view",e),this.setSection("OBJ_BOX"),!0},this.setSectionPlane=function(t,e){if(!t||!e)return!1;var n="OBJ_SET_VIEW_PLANE",i=-1*e.dot(t),o=new THREE.Plane(t,i);y=n;var r=[new THREE.Vector4(o.normal.x,o.normal.y,o.normal.z,o.constant)];return c.setCutPlaneSet("__set_view",r),this.setSection(n),!0}};n(260);n.d(e,"SectionExtension",function(){return s});var s=function(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.viewer=t,this.name="section",this.modes=["x","y","z","box"],this.onViewerSetView=this.onViewerSetView.bind(this),this.onCutPlanesChangedBinded=this.onCutPlanesChanged.bind(this)};s.prototype=Object.create(Autodesk.Viewing.Extension.prototype),s.prototype.constructor=s;var c=s.prototype;c.load=function(){var t=this,e=this.viewer;this.tool=new a(e,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),e.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],e.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),e.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this.onCutPlanesChangedBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var n=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){return t.deactivate()}}];return e.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,n),this.viewer.loadExtension("Autodesk.CompGeom")},c.unload=function(){var t=this.viewer;return t.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),t.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),t.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this.onCutPlanesChangedBinded),t.toolController.deregisterTool(this.tool),this.tool=null,!0},c.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var t=this.sectionStyle||"X";this.setSectionStyle(t,!0)}return this.isActive()},c.getSectionStyle=function(){return this.sectionStyle},c.setSectionStyle=function(t,e){if(-1===this.supportedStyles.indexOf(t))return!1;var n=this.isActive(),i=this.sectionStyle!==t||!e;return this.sectionStyle=t,n&&i?this.tool.setSection(t):n||(this.enableSectionTool(!0),i?this.tool.setSection(t):this.tool.attachControl(!0)),!0},c.setSectionFromPlane=function(t){if(this.deactivate(),t)this.tool.setSectionFromPlane(t),this.tool.attachControl(!1);else{this.tool.clearSection();var e=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(e)}},c.getSectionPlanes=function(){return this.tool.getSectionPlanes()},c.enableSectionTool=function(t){var e=this.viewer.toolController,n=this.tool.isActive();return t&&!n?(e.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(t||!n)&&(e.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},c.getViewValues=function(t){var e=this.tool.getSectionBoxValues(t);if(e)return e;var n=this.tool.getSectionPlaneValues(t);return n||null},c.getState=function(t){if(this.viewer.model&&!this.viewer.model.is2d()){t.cutplanes=t.cutplanes||[];for(var e=this.tool.getSectionPlaneSet(),n=0;n<e.length;n++)t.cutplanes.push(e[n].toArray())}},c.restoreState=function(t,e){this.setSectionFromPlane(null);var n=this.getSectionPlanes();return 1===n.length&&this.setSectionFromPlane(n[0]),!0},c.onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},c.setSectionBox=function(t){t&&(this.enableSectionTool(!0),this.tool.setSectionBox(t)?(this.activeStatus=!0,this.viewer.clearSelection()):this.enableSectionTool(!1))},c.setSectionPlane=function(t,e){t&&e&&(this.enableSectionTool(!0),this.tool.setSectionPlane(t,e)?(this.activeStatus=!0,this.viewer.clearSelection()):this.enableSectionTool(!1))},c.onViewerSetView=function(){this.deactivate()},c.onToolbarCreated=function(t){var e=Autodesk.Viewing.UI;this.sectionToolButton=new e.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var n=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(n){var i=n.getControl("toolbar-resetTool");i?n.addControl(this.sectionToolButton,{index:n.indexOf(i.getId())}):n.addControl(this.sectionToolButton,{index:0})}},c.createSubmenu=function(t){var e=this,n=this.viewer,i=Autodesk.Viewing.UI;function o(t,n){return function(){var o=t.getState(),r=function(){t instanceof i.ComboButton==!1?e.activate(n):(e.enableSectionTool(!0),e.tool.attachControl(!0))};o===i.Button.State.INACTIVE?(t.setState(i.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(r,1):r()):o===i.Button.State.ACTIVE&&(t.setState(i.Button.State.INACTIVE),e.deactivate()),e.sectionStyle=n.toUpperCase()}}var r=this.sectionXButton=new i.Button("toolbar-sectionTool-x");r.setToolTip("Add X plane"),r.setIcon("adsk-icon-plane-x"),r.onClick=o(r,"x"),t.addControl(r);var a=this.sectionYButton=new i.Button("toolbar-sectionTool-y");a.setToolTip("Add Y plane"),a.setIcon("adsk-icon-plane-y"),a.onClick=o(a,"y"),t.addControl(a);var s=this.sectionZButton=new i.Button("toolbar-sectionTool-z");s.setToolTip("Add Z plane"),s.setIcon("adsk-icon-plane-z"),s.onClick=o(s,"z"),t.addControl(s);var c=this.sectionBoxButton=new i.Button("toolbar-sectionTool-box");c.setToolTip("Add box"),c.setIcon("adsk-icon-box"),c.onClick=o(c,"box"),t.addControl(c),n.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,function t(){var i=function(){var t=new THREE.Vector3;return function(e,n,i){return t.subVectors(e,n),t.lengthSq()<i}}(),o=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),s=n.autocam.getWorldRightVector(),c=n.autocam.getWorldUpVector(),l=n.autocam.getWorldFrontVector();i(c,o,1e-4)?e.sectionYButton.setIcon("adsk-icon-plane-x"):i(c,a,1e-4)?e.sectionYButton.setIcon("adsk-icon-plane-z"):e.sectionYButton.setIcon("adsk-icon-plane-y"),i(s,r,1e-4)?e.sectionXButton.setIcon("adsk-icon-plane-y"):i(s,a,1e-4)?e.sectionXButton.setIcon("adsk-icon-plane-z"):e.sectionXButton.setIcon("adsk-icon-plane-x"),i(l,o,1e-4)?e.sectionZButton.setIcon("adsk-icon-plane-x"):i(l,r,1e-4)?e.sectionZButton.setIcon("adsk-icon-plane-y"):e.sectionZButton.setIcon("adsk-icon-plane-z"),n.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,t)})},c.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null)},c.activate=function(t){if(!this.activeStatus||this.mode!==t){switch(this.enableSectionTool(!0),t){default:case"x":this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},c.deactivate=function(){return!!this.activeStatus&&(this.enableSectionTool(!1),this.activeStatus=!1,this.tool.setActiveMode(""),!0)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",s)}});
//# sourceMappingURL=Section.min.js.map